# Сервис проверки ИИН Казахстана

Этот сервис предоставляет API для проверки Индивидуальных Идентификационных Номеров (ИИН) Казахстана и управления информацией о людях.

## Функциональность

1. Проверка ИИН
   - Проверка контрольной суммы ИИН Казахстана
   - Извлечение пола и даты рождения из ИИН

2. Управление информацией о людях
   - Создание записей о людях с именем, ИИН и номером телефона
   - Получение информации о человеке по ИИН
   - Поиск людей по части имени

3. Нагрузочное тестирование
   - Включает инструмент нагрузочного тестирования для проверки стабильности сервиса
   - Настраиваемое количество одновременных запросов с использованием горутин

## API Endpoints

### 1. Проверка ИИН
- **URL**: `/iin_check/{iin}`
- **Метод**: `GET`
- **Ответ**:
```json
{
  "correct": true/false,
  "sex": "female"/"male",
  "date_of_birth": "DD.MM.YYYY"
}
```

### 2. Создание записи о человеке
- **URL**: `/people/info`
- **Метод**: `POST`
- **Тело запроса**:
```json
{
  "name": "Мыркымбаев Мыркымбай Мыркымбайулы",
  "iin": "123123123123",
  "phone": "+71231231234"
}
```
- **Ответ**:
```json
{
  "success": true/false,
  "errors": "сообщение об ошибке, если есть"
}
```

### 3. Получение информации о человеке по ИИН
- **URL**: `/people/info/iin/{iin}`
- **Метод**: `GET`
- **Ответ**:
```json
{
  "name": "Мыркымбаев Мыркымбай Мыркымбайулы",
  "iin": "123123123123",
  "phone": "+71231231234"
}
```

### 4. Поиск людей по части имени
- **URL**: `/people/info/name/{name_part}`
- **Метод**: `GET`
- **Ответ**:
```json
[
  {
    "name": "Мыркымбаев Мыркымбай Мыркымбайулы",
    "iin": "123123123123",
    "phone": "+71231231234"
  },
  {
    "name": "Мыркымбаев Кырыкбай Сайлаубекулы",
    "iin": "123123123123",
    "phone": "+71231231234"
  }
]
```

## Формат ИИН

ИИН Казахстана - это 12-значный номер со следующей структурой:

1. Первые 6 цифр (ГГММДД): Дата рождения
2. 7-я цифра: Пол и век рождения:
   - 1: Мужчина, родившийся в 1900-1999 годах
   - 2: Женщина, родившаяся в 1900-1999 годах
   - 3: Мужчина, родившийся в 2000-2099 годах
   - 4: Женщина, родившаяся в 2000-2099 годах
   - 5: Мужчина, родившийся в 1800-1899 годах
   - 6: Женщина, родившаяся в 1800-1899 годах
   
3. 8-11-я цифры: Регистрационный номер
4. 12-я цифра: Контрольная цифра

## Запуск приложения

### Использование Docker Compose

```bash
# Сборка и запуск всех сервисов
docker-compose up -d

# Просмотр логов
docker-compose logs -f

# Остановка всех сервисов
docker-compose down
```

### Конфигурация

Вы можете настроить приложение, используя переменные среды или файл `.env`:

- `DB_USER`: Имя пользователя базы данных (по умолчанию: "postgres")
- `DB_PASSWORD`: Пароль базы данных (по умолчанию: "qwerty")
- `DB_NAME`: Имя базы данных (по умолчанию: "postgres")
- `DB_HOST`: Хост базы данных (по умолчанию: "postgres" в Docker, "localhost" для локальной разработки)
- `DB_PORT`: Порт базы данных (по умолчанию: "5432")
- `DB_SSLMODE`: Режим SSL базы данных (по умолчанию: "disable")
- `SERVER_PORT`: Порт веб-сервера (по умолчанию: "8080")

Для нагрузочного тестирования:
- `SERVER_URL`: URL сервера для тестирования (по умолчанию: "http://server:8080")
- `NUM_GOROUTINES`: Количество одновременных горутин для тестирования (по умолчанию: 5)
- `NUM_REQUESTS`: Количество запросов на горутину (по умолчанию: 20)

### Локальный запуск

```bash
# Запуск PostgreSQL в Docker
docker run --name=iin-postgres -e POSTGRES_PASSWORD=qwerty -p 5432:5432 -d postgres:14-alpine

# Применение миграций
migrate -path ./schema -database 'postgres://postgres:qwerty@localhost:5432/postgres?sslmode=disable' up

# Запуск сервера
go run cmd/server/main.go

# Запуск нагрузочного теста
go run cmd/stress-test/main.go
```

## Разработка

### Структура проекта

```
iin-service/
├── cmd/
│   ├── server/         # Точка входа веб-сервиса
│   └── stress-test/    # Программа нагрузочного тестирования
├── internal/
│   ├── api/            # HTTP обработчики и маршрутизатор
│   ├── model/          # Модели данных
│   ├── repository/     # Операции с базой данных
│   └── service/        # Бизнес-логика (проверка ИИН)
├── schema/             # Миграции базы данных
├── docker-compose.yml
├── Dockerfile.server
├── Dockerfile.stress-test
└── go.mod
```